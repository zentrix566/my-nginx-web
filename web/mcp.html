<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP è¿ç»´çœ‹æ¿</title>
    <style>
        :root { --primary: #007bff; --bg: #1e1e2e; --text: #cdd6f4; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 40px; }
        .card { background: #313244; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); max-width: 500px; }
        .stat-item { margin-bottom: 20px; }
        .progress-bar { background: #45475a; height: 12px; border-radius: 6px; overflow: hidden; margin-top: 8px; }
        .progress-fill { background: var(--primary); height: 100%; width: 0%; transition: width 0.5s ease; }
        button { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:hover { opacity: 0.9; }
        #status-text { margin-top: 15px; font-size: 0.9em; color: #a6adc8; }
    </style>
</head>
<body>

    <div class="card">
        <h2>ğŸš€ æœåŠ¡å™¨ç›‘æ§ (MCP)</h2>
        <div class="stat-item">
            <span>CPU ä½¿ç”¨ç‡</span>
            <div class="progress-bar"><div id="cpu-fill" class="progress-fill"></div></div>
        </div>
        <div class="stat-item">
            <span>å†…å­˜ä½¿ç”¨ç‡</span>
            <div class="progress-bar"><div id="mem-fill" class="progress-fill"></div></div>
        </div>
        <button onclick="updateStats()">ç«‹å³åˆ·æ–°</button>
        <div id="status-text">ç­‰å¾…è¿æ¥...</div>
    </div>

    <script>
        const sseUrl = "http://39.106.136.18:8000/sse";
        let messageUrl = "";

        // åˆå§‹åŒ– SSE
        const eventSource = new EventSource(sseUrl);
        eventSource.addEventListener("endpoint", (e) => {
            messageUrl = "http://39.106.136.18:8000" + e.data;
            document.getElementById('status-text').innerText = "âœ… è¿æ¥æˆåŠŸ";
        });

        async function updateStats() {
            if (!messageUrl) return;
            document.getElementById('status-text').innerText = "âš¡ æ­£åœ¨è¯·æ±‚æ•°æ®...";
            
            try {
                const response = await fetch(messageUrl, {
                    method: "POST",
                    body: JSON.stringify({
                        jsonrpc: "2.0", id: 1, method: "tools/call",
                        params: { name: "get_system_status", arguments: {} }
                    })
                });
                const data = await response.json();
                
                // å‡è®¾è¿”å›æ ¼å¼æ˜¯ {"cpu_usage": "15.2%", "memory_usage": "45.0%"}
                const content = JSON.parse(data.result.content[0].text);
                
                const cpu = content.cpu_usage.replace('%', '');
                const mem = content.memory_usage.replace('%', '');

                document.getElementById('cpu-fill').style.width = cpu + '%';
                document.getElementById('mem-fill').style.width = mem + '%';
                document.getElementById('status-text').innerText = `æœ€åæ›´æ–°: ${new Date().toLocaleTimeString()}`;
            } catch (err) {
                document.getElementById('status-text').innerText = "âŒ è°ƒç”¨å¤±è´¥: " + err;
            }
        }
    </script>
</body>
</html>